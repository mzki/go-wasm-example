<!doctype html>
<html>
  <head>
    <title>Testing WebAssembly</title>
    <style>
      #canvas {
		  position: absolute;
		  left: 0px;
	  }
    </style>
    <script src="wasm_exec.js"></script>
    <script type="text/javascript">

const go = new Go(); // Defined in wasm_exec.js
const WASM_URL = 'wasm.wasm';

// Providing the environment object, used in WebAssembly.instantiateStreaming.
// This part goes after "const go = new Go();" declaration.
go.importObject.env = {
    'main.add': function(x, y) {
        return x + y
    }
    // ... other functions
}

function wasm_test_call(wasm) {
    // Calling the multiply function:
    console.log('multiplied two numbers:', wasm.exports.multiply(5, 3));
}

var wasm;

if ('instantiateStreaming' in WebAssembly) {
	WebAssembly.instantiateStreaming(fetch(WASM_URL), go.importObject).then(function (obj) {
		wasm = obj.instance;
		go.run(wasm);
    wasm_test_call(wasm)
	})
} else {
	fetch(WASM_URL).then(resp =>
		resp.arrayBuffer()
	).then(bytes =>
		WebAssembly.instantiate(bytes, go.importObject).then(function (obj) {
			wasm = obj.instance;
			go.run(wasm);
      wasm_test_call(wasm)
		})
	)
}

    </script>
  </head>
  <body>
    <canvas id="canvas"></canvas>
  </body>
</html>
